import{d as W,L as se,a as T,e as S,i as g,a0 as ne,r,l as ie,m as re,f as s,g as a,w as x,b as w,y as I,t as ue,T as z,c as me,A as pe,F as de,u as ce,Y as fe,E as H,q as ge,a1 as he,_ as ve}from"./index-43fa284a.js";/* empty css                     */import"./el-col-327ca27f.js";import{C as _e}from"./CPageContainer-285012f3.js";import{S as _}from"./http-7590b1ae.js";import{d as ye,r as O}from"./validate-14f65514.js";import{C as Q}from"./CCardContainer-6404432a.js";import{E as be}from"./EImg-f0d9a1a1.js";import{E as we,a as Te}from"./EUploadArea-cb398eb6.js";import{B as C,_ as E}from"./BaseService-ae473529.js";import{_ as G}from"./EInputNumber.vue_vue_type_script_setup_true_lang-1ef99ed1.js";import{V as Ve,E as Ue}from"./datetime-983c5328.js";import{f as xe,a as Ie}from"./datetime-8fa1e943.js";import{C as L}from"./ConsignmentsService-2d91f76d.js";import{E as Ce}from"./index-4dd40978.js";import{E as Ee,a as Le}from"./index-c461f170.js";import{E as Se,a as qe}from"./index-8a25c6f7.js";import"./index-45ffb881.js";import"./event-9519ab40.js";import"./validator-183bd9e8.js";import"./flatten-2355c2af.js";const K=W({__name:"EDatePicker",props:{disabled:{type:Boolean,default:!1},from:{default:null},placeholder:{default:"Vui lòng chọn"}},emits:["update:from"],setup(q,{emit:h}){const m=q,d=se({get(){return xe(m.from)},set(t){if(!t)h("update:from",null);else{const c=Ie(t);h("update:from",c)}}});return(t,c)=>{const v=Ue;return T(),S(v,{disabled:m.disabled,modelValue:g(d),"onUpdate:modelValue":c[0]||(c[0]=f=>ne(d)?d.value=f:null),type:"date",placeholder:m.placeholder,format:g(Ve),clearable:""},null,8,["disabled","modelValue","placeholder","format"])}}}),De={class:"d-flex align-items-center justify-between mb-16"},ke={class:"d-flex align-items-center justify-between mb-16"},Ne={class:"form__images d-flex align-items-center justify-start flex-wrap"},Pe={class:"form__actions d-flex justify-end align-items-center mt-16"},Re=W({__name:"ConsignmentsForm",setup(q){const h=ce(),m=fe(),d=r(),t=r({name:"",code:"",images:[],shipmentTypeId:null,productId:null,weight:null,quantity:null,quantityUnit:"",weightUnit:"g",produceTime:"",expiryDate:""}),c=r({name:[ye({required:!0,message:"Tên lô hàng là bắt buộc",trigger:"change"})],shipmentTypeId:[O({required:!0,message:"Loại lô hàng là bắt buộc",trigger:"change"})],productId:[O({required:!0,message:"Sản phẩm là bắt buộc",trigger:"change"})]}),v=r(!1),f=r(!1),y=r(!1),u=ie({unitList:[],shipmentTypeList:[],productList:[],weightUnitList:[]}),D=r({page:1,pageSize:10,key:""}),k=r({page:1,pageSize:10,keyword:""}),p=r(m.params.id?m.params.id.toString():null),N=r(m.path.split("/")[m.path.split("/").length-2]);re(async()=>{await Promise.all([ee(),R()]),p.value?await Y(p.value):await V()});const Y=async l=>{const{code:e,data:n}=await L.getDetail(l);e===_&&J(n)},J=async l=>{await V(l.productName),t.value={name:l.name||"",code:l.code||"",images:l.images||[],shipmentTypeId:l.shipmentTypeId||null,productId:l.productId||null,weight:l.weight||null,quantity:l.quantity||null,quantityUnit:l.quantityUnit||null,weightUnit:l.weightUnit||null,produceTime:l.produceTime||"",expiryDate:l.expiryDate||""}},P=l=>{var e;(e=t.value.images)==null||e.push(l.url)},X=l=>{var e;(e=t.value.images)==null||e.splice(l,1)},V=async l=>{try{f.value=!0,k.value.keyword=l?l.trim():"";const{code:e,data:n}=await C.getListProduct(k.value);e===_&&(u.productList=n.items,f.value=!1)}catch{f.value=!1}},Z=l=>{u.productList.map(e=>{e.value===l&&(t.value.quantityUnit=e.data.unit)})},R=async l=>{try{y.value=!0,D.value.key=l?l.trim():"";const{code:e,data:n}=await C.getListShipmentType(D.value);e===_&&(u.shipmentTypeList=n.items,y.value=!1)}catch{y.value=!1}},ee=async()=>{try{const{code:l,data:e}=await C.getUnits("PRODUCT_UNIT");l===_&&(u.unitList=e.UNIT,u.weightUnitList=e.WEIGHT_UNIT,console.log("data",u.unitList))}catch{}},te=async l=>{l&&await l.validate(async e=>{if(e)try{v.value=!0;let n="";p.value&&(n="Cập nhật thành công"),p.value||(n="Thêm mới thành công"),p.value&&N.value==="coppy"&&(n="Nhân bản thành công");const i={...t.value,name:t.value.name?t.value.name.trim():"",code:t.value.code?t.value.code.toUpperCase().trim().replace(/\s/g,""):""},{code:b,message:U}=p.value&&N.value!=="coppy"?await L.update(Number(p.value),i):await L.create(i);if(b===_)return H({message:n,type:"success"}),h.pushByPath("/consignments");H({message:U,type:"error"})}catch(n){console.log(n)}finally{v.value=!1}})};return(l,e)=>{const n=Ce,i=Ee,b=Se,U=qe,le=Le,B=ge,ae=he("uppercase-trim");return T(),S(g(_e),{class:"form",title:""},{default:s(()=>[a(le,{ref_key:"formRef",ref:d,model:t.value,rules:c.value,"label-position":"top"},{default:s(()=>[a(U,{gutter:30},{default:s(()=>[a(b,{xs:24,md:16},{default:s(()=>[a(g(Q),{title:"Thông tin chung",class:"mb-16 h-full"},{default:s(()=>[a(i,{label:"Tên lô hàng",required:"",class:"mb-16",prop:"name"},{default:s(()=>[a(n,{modelValue:t.value.name,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.name=o),placeholder:"Nhập tên lô hàng"},null,8,["modelValue"])]),_:1}),a(i,{label:"Mã lô hàng",class:"mb-16",prop:"code"},{default:s(()=>[x(a(n,{modelValue:t.value.code,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.code=o),maxlength:256,placeholder:"Nhập mã lô hàng"},null,8,["modelValue"]),[[ae]])]),_:1}),a(i,{required:"",label:"Loại lô hàng",class:"mb-16",prop:"shipmentTypeId"},{default:s(()=>[a(E,{items:u.shipmentTypeList,remote:!0,filterable:!0,"reserve-keyword":!0,"remote-show-suffix":!0,loading:y.value,remoteMethod:R,"item-value":"value","item-label":"label",modelValue:t.value.shipmentTypeId,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.shipmentTypeId=o),class:"w-full",placeholder:"Vui lòng chọn"},null,8,["items","loading","modelValue"])]),_:1}),a(i,{required:"",label:"Sản phẩm",class:"mb-16",prop:"productId"},{default:s(()=>[a(E,{items:u.productList,remote:!0,filterable:!0,"reserve-keyword":!0,"remote-show-suffix":!0,loading:f.value,remoteMethod:V,"item-value":"value","item-label":"label",modelValue:t.value.productId,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.productId=o),class:"w-full",placeholder:"Vui lòng chọn",onChange:Z},null,8,["items","loading","modelValue"])]),_:1}),w("div",De,[a(i,{label:"Ngày sản xuất",class:"pr-8 flex-50",prop:"produceTime"},{default:s(()=>[a(K,{class:"w-full",from:t.value.produceTime,"onUpdate:from":e[4]||(e[4]=o=>t.value.produceTime=o),type:"date",placeholder:"Vui lòng chọn"},null,8,["from"])]),_:1}),a(i,{label:"Hạn sử dụng",class:"flex-50",prop:"expiryDate"},{default:s(()=>[a(K,{class:"w-full",from:t.value.expiryDate,"onUpdate:from":e[5]||(e[5]=o=>t.value.expiryDate=o),type:"date",placeholder:"Vui lòng chọn"},null,8,["from"])]),_:1})]),w("div",ke,[a(i,{label:"Khối lượng",class:"pr-8 flex-50",prop:"weight"},{default:s(()=>[a(G,{modelValue:t.value.weight,"onUpdate:modelValue":e[7]||(e[7]=o=>t.value.weight=o),placeholder:"Nhập khối lượng"},{append:s(()=>[a(E,{clearable:!1,items:u.weightUnitList,"item-value":"value","item-label":"description",modelValue:t.value.weightUnit,"onUpdate:modelValue":e[6]||(e[6]=o=>t.value.weightUnit=o),style:{width:"80px"}},null,8,["items","modelValue"])]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"Số lượng",class:"flex-50",prop:"quantity"},{default:s(()=>[a(G,{modelValue:t.value.quantity,"onUpdate:modelValue":e[8]||(e[8]=o=>t.value.quantity=o),placeholder:"Nhập số lượng"},{append:s(()=>[I(ue(t.value.quantityUnit)+" ",1)]),_:1},8,["modelValue"])]),_:1})])]),_:1})]),_:1}),a(b,{xs:24,md:8},{default:s(()=>[a(g(Q),{title:"Ảnh lô hàng",class:"mb-16 h-full"},{default:s(()=>{var o,F,M,$,j;return[x(w("div",Ne,[(T(!0),me(de,null,pe((o=t.value)==null?void 0:o.images,(oe,A)=>(T(),S(be,{src:oe,key:A,index:A,size:"80px","show-remove":"",class:"mr-16 mb-8",radius:"6px",onRemove:X},null,8,["src","index"]))),128)),a(we,{multiple:!0,onChange:P,title:"Tải lên"})],512),[[z,(M=(F=t.value)==null?void 0:F.images)==null?void 0:M.length]]),x(a(Te,{onChange:P},null,512),[[z,!((j=($=t.value)==null?void 0:$.images)!=null&&j.length)]])]}),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"]),w("div",Pe,[a(B,{class:"form__actions__btn form__actions__btn--cancel",onClick:e[9]||(e[9]=o=>g(h).pushByPath("/consignments"))},{default:s(()=>[I("Hủy bỏ ")]),_:1}),a(B,{class:"form__actions__btn",type:"primary",onClick:e[10]||(e[10]=o=>te(d.value)),loading:v.value},{default:s(()=>[I("Lưu lại ")]),_:1},8,["loading"])])]),_:1})}}});const ot=ve(Re,[["__scopeId","data-v-0e9ee570"]]);export{ot as default};
